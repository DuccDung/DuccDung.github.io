<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>V√≤ng xoay l√¨ x√¨</title>

    <style>
      :root {
        --bg1: #8a0f14; /* ƒë·ªè t·∫øt */
        --bg2: #2b0709; /* ƒë·ªè t√≠m ƒë·∫≠m */
        --gold: #fbbf24;
        --text: #fff7ed;
        --muted: rgba(255, 247, 237, 0.78);
        --shadow: 0 18px 60px rgba(0, 0, 0, 0.45);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial;
        color: var(--text);
        background:
          radial-gradient(
            900px 650px at 18% 18%,
            rgba(251, 191, 36, 0.22),
            transparent 55%
          ),
          radial-gradient(
            900px 650px at 82% 25%,
            rgba(255, 255, 255, 0.06),
            transparent 60%
          ),
          radial-gradient(
            900px 700px at 55% 95%,
            rgba(239, 68, 68, 0.22),
            transparent 60%
          ),
          linear-gradient(145deg, var(--bg1), var(--bg2));
        padding: 18px;
        position: relative;
        overflow-x: hidden;
      }

      /* H√åNH N·ªÄN CON NG·ª∞A M·ªú (kh√¥ng che v√≤ng quay) */
      body::before {
        content: "üêé";
        position: fixed;
        left: 50%;
        top: 52%;
        transform: translate(-50%, -50%) rotate(-8deg);
        font-size: min(48vw, 520px);
        opacity: 0.055; /* m·ªù */
        filter: blur(0.6px);
        pointer-events: none; /* kh√¥ng c·∫£n click */
        z-index: 0; /* n·∫±m d∆∞·ªõi */
        line-height: 1;
      }

      .wrap {
        width: min(560px, 92vw);
        position: relative;
        z-index: 1; /* ƒë√® l√™n n·ªÅn con ng·ª±a */
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.09),
          rgba(255, 255, 255, 0.03)
        );
        border: 1px solid rgba(251, 191, 36, 0.16);
        border-radius: 22px;
        box-shadow: var(--shadow);
        padding: 18px 16px 16px;
        position: relative;
        overflow: hidden;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 12px;
      }

      .title h1 {
        margin: 0;
        font-size: 18px;
        letter-spacing: 0.2px;
      }

      .title small {
        display: block;
        margin-top: 4px;
        color: var(--muted);
        font-size: 12px;
      }

      .stage {
        position: relative;
        display: grid;
        place-items: center;
        padding: 14px 8px 8px;
      }

      .wheel-shell {
        position: relative;
        width: min(420px, 82vw);
        aspect-ratio: 1/1;
        border-radius: 999px;
        padding: 14px;
        background:
          radial-gradient(
            circle at 30% 30%,
            rgba(251, 191, 36, 0.28),
            transparent 55%
          ),
          radial-gradient(
            circle at 70% 70%,
            rgba(239, 68, 68, 0.22),
            transparent 55%
          ),
          linear-gradient(
            180deg,
            rgba(255, 255, 255, 0.09),
            rgba(255, 255, 255, 0.02)
          );
        border: 1px solid rgba(255, 255, 255, 0.12);
        box-shadow: 0 24px 80px rgba(0, 0, 0, 0.42);
      }

      canvas {
        width: 100%;
        height: 100%;
        display: block;
        border-radius: 999px;
        background: rgba(2, 6, 23, 0.48);
        box-shadow: inset 0 0 0 10px rgba(255, 255, 255, 0.04);
      }

      /* Kim ·ªü 12 gi·ªù, m≈©i t√™n h∆∞·ªõng v√†o t√¢m (chƒ©a xu·ªëng) */
      .pointer {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;

        /* tam gi√°c chƒ©a xu·ªëng (v·ªÅ t√¢m) */
        border-left: 14px solid transparent;
        border-right: 14px solid transparent;
        border-top: 30px solid var(--gold);

        filter: drop-shadow(0 10px 12px rgba(0, 0, 0, 0.35));
        z-index: 6;
      }

      .pointer::after {
        display: none;
        content: "";
        position: absolute;
        left: 50%;
        top: -10px; /* v√¨ gi·ªù d√πng border-top */
        transform: translateX(-50%);
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: #111827;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.14);
      }

      /* N√∫t trung t√¢m: lu√¥n ·ªü gi·ªØa */
      .hub {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%); /* chu·∫©n */
        z-index: 7;

        width: 98px;
        height: 98px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        background:
          radial-gradient(
            circle at 30% 30%,
            rgba(255, 255, 255, 0.22),
            rgba(255, 255, 255, 0.05) 55%,
            rgba(0, 0, 0, 0.22)
          ),
          linear-gradient(
            180deg,
            rgba(251, 191, 36, 0.62),
            rgba(239, 68, 68, 0.36)
          );
        border: 1px solid rgba(255, 255, 255, 0.18);
        box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
        user-select: none;
        cursor: pointer;
        transition:
          transform 0.12s ease,
          filter 0.2s ease;
      }

      /* active v·∫´n gi·ªØ translate ƒë·ªÉ kh√¥ng b·ªã "nh·∫£y" */
      .hub:active {
        transform: translate(-50%, -50%) scale(0.985);
      }

      .hub .btn {
        width: 84px;
        height: 84px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        gap: 2px;
        background: rgba(17, 24, 39, 0.88);
        border: 1px solid rgba(255, 255, 255, 0.14);
        color: var(--text);
        font-weight: 800;
        letter-spacing: 0.6px;
        text-transform: uppercase;
        box-shadow: inset 0 0 0 6px rgba(255, 255, 255, 0.04);
      }
      .hub .btn span {
        font-size: 11px;
        color: var(--muted);
        font-weight: 600;
        letter-spacing: 0.2px;
        text-transform: none;
      }

      /* Hi·ªáu ·ª©ng ƒÉn m·ª´ng KH√îNG ƒë·ª•ng transform (tr√°nh nh·∫£y) */
      .hub.pop {
        animation: popGlow 260ms ease-out 1;
      }
      @keyframes popGlow {
        0% {
          filter: brightness(1);
        }
        40% {
          filter: brightness(1.18);
        }
        100% {
          filter: brightness(1);
        }
      }

      .footer {
        margin-top: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
      }

      .result {
        font-size: 14px;
        color: var(--text);
        background: rgba(2, 6, 23, 0.45);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 10px 12px;
        border-radius: 14px;
        flex: 1;
        min-width: 220px;
      }
      .result b {
        color: var(--gold);
      }

      @media (max-width: 420px) {
        .hub {
          width: 90px;
          height: 90px;
        }
        .hub .btn {
          width: 78px;
          height: 78px;
        }
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="card">
        <div class="header">
          <div class="title">
            <h1>V√≤ng xoay may m·∫Øn l√¨ x√¨</h1>
          </div>
        </div>

        <div class="stage">
          <div class="wheel-shell">
            <div class="pointer" aria-hidden="true"></div>
            <canvas id="wheel" width="900" height="900"></canvas>

            <div class="hub" id="spinBtn" role="button" aria-label="Quay">
              <div class="btn">QUAY</div>
            </div>
          </div>

          <div class="footer">
            <div class="result" id="result">K·∫øt qu·∫£: <b>‚Äî</b></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      (() => {
        const canvas = document.getElementById("wheel");
        const ctx = canvas.getContext("2d");
        const spinBtn = document.getElementById("spinBtn");
        const resultEl = document.getElementById("result");

        // ƒê·ªß 1k 2k 5k 10k 20k 50k 100k 200k 500k
        // 100k/200k/500k ƒë·∫∑t weight=0 => KH√îNG BAO GI·ªú TR√öNG
        const prizes = [
          { label: "1k", value: 1000, weight: 58 },
          { label: "2k", value: 2000, weight: 22 },
          { label: "5k", value: 5000, weight: 10 },
          { label: "10k", value: 10000, weight: 6 },
          { label: "20k", value: 20000, weight: 3 }, // trung b√¨nh
          { label: "50k", value: 50000, weight: 1 }, // th·∫•p
          { label: "100k", value: 100000, weight: 0 }, // kh√¥ng tr√∫ng
          { label: "200k", value: 200000, weight: 0 }, // kh√¥ng tr√∫ng
          { label: "500k", value: 500000, weight: 0 }, // kh√¥ng tr√∫ng
        ];

        let angle = 0;
        let spinning = false;

        const palette = [
          ["#ef4444", "#b91c1c"],
          ["#f59e0b", "#b45309"],
          ["#22c55e", "#15803d"],
          ["#60a5fa", "#1d4ed8"],
          ["#fb7185", "#be123c"],
          ["#a78bfa", "#6d28d9"],
          ["#34d399", "#047857"],
          ["#fbbf24", "#b45309"],
          ["#f87171", "#991b1b"],
        ];

        function dprScale() {
          const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
          const cssSize = canvas.getBoundingClientRect().width;
          const px = Math.floor(cssSize * dpr);
          canvas.width = px;
          canvas.height = px;
        }

        function drawWheel() {
          const w = canvas.width;
          const h = canvas.height;
          const cx = w / 2,
            cy = h / 2;
          const radius = Math.min(cx, cy) - 22;

          ctx.clearRect(0, 0, w, h);

          // glow nh·∫π
          const bg = ctx.createRadialGradient(
            cx,
            cy,
            radius * 0.15,
            cx,
            cy,
            radius * 1.06,
          );
          bg.addColorStop(0, "rgba(251,191,36,.18)");
          bg.addColorStop(0.55, "rgba(239,68,68,.12)");
          bg.addColorStop(1, "rgba(0,0,0,0)");
          ctx.fillStyle = bg;
          ctx.beginPath();
          ctx.arc(cx, cy, radius * 1.08, 0, Math.PI * 2);
          ctx.fill();

          ctx.save();
          ctx.translate(cx, cy);
          ctx.rotate(angle);

          const n = prizes.length;
          const slice = (Math.PI * 2) / n;

          for (let i = 0; i < n; i++) {
            const start = i * slice;
            const end = start + slice;

            const [c1, c2] = palette[i % palette.length];
            const g = ctx.createLinearGradient(
              Math.cos(start) * radius,
              Math.sin(start) * radius,
              Math.cos(end) * radius,
              Math.sin(end) * radius,
            );
            g.addColorStop(0, c1);
            g.addColorStop(1, c2);

            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.arc(0, 0, radius, start, end);
            ctx.closePath();
            ctx.fillStyle = g;
            ctx.fill();

            ctx.strokeStyle = "rgba(255,255,255,.16)";
            ctx.lineWidth = 5;
            ctx.stroke();

            const mid = start + slice / 2;
            ctx.save();
            ctx.rotate(mid);
            ctx.translate(radius * 0.68, 0);
            ctx.rotate(Math.PI / 2);

            const isNever = prizes[i].weight === 0;
            ctx.fillStyle = isNever
              ? "rgba(255,255,255,.78)"
              : "rgba(255,255,255,.96)";
            ctx.font = `800 ${Math.floor(radius * 0.11)}px ui-sans-serif, system-ui`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(prizes[i].label, 0, 0);

            if (isNever) {
              ctx.fillStyle = "rgba(17,24,39,.92)";
              ctx.font = `700 ${Math.floor(radius * 0.052)}px ui-sans-serif, system-ui`;
              ctx.fillText("", 0, Math.floor(radius * 0.11));
            }
            ctx.restore();
          }

          ctx.restore();

          // vi·ªÅn nh≈© v√†ng
          ctx.beginPath();
          ctx.arc(cx, cy, radius + 8, 0, Math.PI * 2);
          ctx.strokeStyle = "rgba(251,191,36,.68)";
          ctx.lineWidth = 10;
          ctx.stroke();

          // v√≤ng trong
          ctx.beginPath();
          ctx.arc(cx, cy, radius * 0.18, 0, Math.PI * 2);
          ctx.fillStyle = "rgba(17,24,39,.62)";
          ctx.fill();
          ctx.strokeStyle = "rgba(255,255,255,.14)";
          ctx.lineWidth = 6;
          ctx.stroke();
        }

        function pickWeightedIndex() {
          const pool = prizes
            .map((p, i) => ({ i, w: Math.max(0, p.weight) }))
            .filter((x) => x.w > 0);

          const total = pool.reduce((s, x) => s + x.w, 0);
          let r = Math.random() * total;

          for (const x of pool) {
            r -= x.w;
            if (r <= 0) return x.i;
          }
          return pool[pool.length - 1].i;
        }

        function easeOutCubic(t) {
          return 1 - Math.pow(1 - t, 3);
        }

        function spin() {
          if (spinning) return;
          spinning = true;

          const n = prizes.length;
          const slice = (Math.PI * 2) / n;
          const chosen = pickWeightedIndex();

          // kim ch·ªâ ·ªü ƒë·ªânh (-90 ƒë·ªô)
          const pointerAngle = -Math.PI / 2;
          const targetCenter = (chosen + 0.5) * slice;
          let target = pointerAngle - targetCenter;

          target = ((target % (Math.PI * 2)) + Math.PI * 2) % (Math.PI * 2);

          const start = angle;
          const extraTurns =
            (Math.floor(Math.random() * 3) + 6) * (Math.PI * 2); // 6‚Äì8 v√≤ng
          const end = target + extraTurns;

          const duration = 4200;
          const t0 = performance.now();

          const tick = (now) => {
            const t = Math.min(1, (now - t0) / duration);
            const e = easeOutCubic(t);
            angle = start + (end - start) * e;
            drawWheel();

            if (t < 1) {
              requestAnimationFrame(tick);
              return;
            }

            // ch·ªët ƒë√∫ng target
            angle = target;
            drawWheel();
            spinning = false;

            const p = prizes[chosen];
            resultEl.innerHTML = `K·∫øt qu·∫£: <b>${p.label}</b>`;

            // hi·ªáu ·ª©ng pop kh√¥ng l√†m "nh·∫£y" n√∫t
            spinBtn.classList.remove("pop");
            // reflow ƒë·ªÉ restart animation
            void spinBtn.offsetWidth;
            spinBtn.classList.add("pop");
          };

          requestAnimationFrame(tick);
        }

        function init() {
          dprScale();
          drawWheel();
        }

        window.addEventListener("resize", init);
        spinBtn.addEventListener("click", spin);

        init();
      })();
    </script>
  </body>
</html>
